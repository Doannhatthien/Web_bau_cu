<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng B·∫ßu C·ª≠ L·ªõp - Blockchain</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üó≥Ô∏è H·ªá Th·ªëng B·∫ßu C·ª≠ L·ªõp Online</h1>
            <p class="subtitle">D·ª±a tr√™n c√¥ng ngh·ªá Blockchain - Minh b·∫°ch & B·∫£o m·∫≠t</p>
            
            <!-- Th√¥ng tin ng∆∞·ªùi d√πng -->
            <div class="user-info" id="userInfo" style="display: none;">
                <div class="user-details">
                    <div class="user-avatar">üë§</div>
                    <div class="user-text">
                        <h3 id="userName">-</h3>
                        <p id="userRole">-</p>
                    </div>
                </div>
                <button class="logout-btn" id="logoutBtn">ƒêƒÉng xu·∫•t</button>
            </div>
        </header>

        <!-- Th√¥ng tin k·∫øt n·ªëi -->
        <div class="connection-status" id="connectionStatus">
            <div class="status-item">
                <span>Tr·∫°ng th√°i:</span>
                <span id="statusText" class="status-disconnected">Ch∆∞a k·∫øt n·ªëi</span>
            </div>
            <div class="status-item">
                <span>ƒê·ªãa ch·ªâ v√≠:</span>
                <span id="accountAddress">Ch∆∞a k·∫øt n·ªëi</span>
            </div>
            <div class="status-item">
                <span>Vai tr√≤:</span>
                <span id="userRole2">-</span>
            </div>
        </div>

        <button id="connectWallet" class="btn btn-primary btn-large">K·∫øt n·ªëi MetaMask</button>

        <!-- Election Mode Navigation -->
        <div class="section" style="background: linear-gradient(135deg, #FFF3E0, #FFE0B2); padding: 20px; border-radius: 15px; margin: 20px 0;">
            <h3 style="margin: 0 0 15px 0; color: var(--dark-color);">üó≥Ô∏è Ch·∫ø ƒë·ªô B·∫ßu c·ª≠</h3>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button onclick="window.location.href='index.html'" class="btn btn-primary" style="flex: 1; min-width: 200px;">
                    üåê B·∫ßu c·ª≠ C√¥ng khai
                </button>
                <button onclick="window.location.href='private-voting.html'" class="btn btn-danger" style="flex: 1; min-width: 200px;">
                    üîí B·∫ßu c·ª≠ Kh√©p k√≠n
                </button>
                <button onclick="window.location.href='election-config.html'" class="btn btn-warning admin-only" style="flex: 1; min-width: 200px; display: none;" id="configBtn">
                    ‚öôÔ∏è C·∫•u h√¨nh (Admin)
                </button>
            </div>
            <div id="currentModeDisplay" style="margin-top: 15px; padding: 15px; background: white; border-radius: 10px; text-align: center;">
                <strong>Ch·∫ø ƒë·ªô hi·ªán t·∫°i:</strong> <span id="currentModeText">ƒêang t·∫£i...</span>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tabs" id="tabs">
            <button class="tab-button active" data-tab="voting">B·ªè Phi·∫øu</button>
            <button class="tab-button" data-tab="results">K·∫øt Qu·∫£</button>
            <button class="tab-button" data-tab="registration">ƒêƒÉng K√Ω ·ª®ng Vi√™n</button>
            <button class="tab-button admin-only" data-tab="admin">Qu·∫£n Tr·ªã</button>
        </div>

        <!-- Voting Tab -->
        <div class="tab-content active" id="voting">
            <div class="section">
                <h2>üéØ Th√¥ng Tin B·∫ßu C·ª≠</h2>
                <div class="info-grid">
                    <div class="info-card">
                        <h3>Tr·∫°ng th√°i b·∫ßu c·ª≠</h3>
                        <p id="electionState" class="state-text">-</p>
                    </div>
                    <div class="info-card">
                        <h3>S·ªë ·ª©ng vi√™n</h3>
                        <p id="candidateCount" class="count-text">0</p>
                    </div>
                    <div class="info-card">
                        <h3>T·ªïng s·ªë phi·∫øu</h3>
                        <p id="totalVotes" class="count-text">0</p>
                    </div>
                    <div class="info-card">
                        <h3>Tr·∫°ng th√°i c·ªßa b·∫°n</h3>
                        <p id="voterStatus" class="status-text">-</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üë• Danh S√°ch ·ª®ng Vi√™n</h2>
                <div id="candidatesList" class="candidates-list">
                    <p class="empty-state">Ch∆∞a c√≥ ·ª©ng vi√™n n√†o</p>
                </div>
            </div>
        </div>

        <!-- Results Tab -->
        <div class="tab-content" id="results">
            <div class="section">
                <h2>üìä K·∫øt Qu·∫£ B·∫ßu C·ª≠</h2>
                <button id="refreshResults" class="btn btn-secondary">L√†m m·ªõi k·∫øt qu·∫£</button>
                <div id="resultsList" class="results-list">
                    <p class="empty-state">Ch∆∞a c√≥ k·∫øt qu·∫£</p>
                </div>
            </div>
        </div>

        <!-- Registration Tab -->
        <div class="tab-content" id="registration">
            <div class="section">
                <h2>üìù ƒêƒÉng K√Ω ·ª®ng Vi√™n</h2>
                <p class="description">ƒêƒÉng k√Ω tham gia ·ª©ng c·ª≠ v√†o ban c√°n s·ª± l·ªõp</p>
                
                <form id="candidateForm" class="form">
                    <div class="form-group">
                        <label for="candidateName">H·ªç v√† t√™n:</label>
                        <input type="text" id="candidateName" placeholder="Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="candidatePosition">V·ªã tr√≠ ·ª©ng c·ª≠:</label>
                        <select id="candidatePosition" required>
                            <option value="">-- Ch·ªçn v·ªã tr√≠ --</option>
                            <option value="Lop truong">L·ªõp tr∆∞·ªüng</option>
                            <option value="Lop pho">L·ªõp ph√≥</option>
                            <option value="Bi thu">B√≠ th∆∞</option>
                            
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-success">ƒêƒÉng k√Ω ·ª©ng c·ª≠</button>
                </form>
            </div>
        </div>

        <!-- Admin Tab -->
        <div class="tab-content admin-only" id="admin">
            <div class="section">
                <h2>‚öôÔ∏è Qu·∫£n Tr·ªã H·ªá Th·ªëng</h2>
                <p>Ch·ª©c nƒÉng qu·∫£n tr·ªã d√†nh cho admin</p>
            </div>
        </div>

        <footer>
            <p>¬© 2025 - H·ªá Th·ªëng B·∫ßu C·ª≠ L·ªõp Blockchain | Ph√°t tri·ªÉn v·ªõi Ethereum & Solidity</p>
        </footer>
    </div>

    <!-- Loading overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <p>ƒêang x·ª≠ l√Ω...</p>
    </div>

    <!-- Scripts - Kh√¥ng load Web3 ƒë·ªÉ tr√°nh l·ªói -->
    <script src="auth.js"></script>
    <script>
        // Simple version without Web3
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                checkAuth();
                initializeSimpleUI();
                setupSimpleListeners();
            }, 100);
        });

        function checkAuth() {
            try {
                if (!window.authModule || typeof window.authModule.getCurrentUser !== 'function') {
                    console.log('Auth module ch∆∞a s·∫µn s√†ng, chuy·ªÉn v·ªÅ trang ƒëƒÉng nh·∫≠p');
                    window.location.href = 'login.html';
                    return;
                }
                
                const currentUser = window.authModule.getCurrentUser();
                
                if (!currentUser) {
                    window.location.href = 'login.html';
                    return;
                }
                
                const userInfo = document.getElementById('userInfo');
                const userName = document.getElementById('userName');
                const userRoleText = document.getElementById('userRole');
                
                if (userInfo && userName && userRoleText) {
                    userInfo.style.display = 'flex';
                    userName.textContent = currentUser.fullName;
                    userRoleText.textContent = currentUser.role === 'admin' ? 'üëë Qu·∫£n tr·ªã vi√™n' : 'üéì ' + currentUser.studentId;
                }
                
                // Hi·ªÉn th·ªã admin tab n·∫øu l√† admin
                if (currentUser.role === 'admin') {
                    document.querySelectorAll('.admin-only').forEach(el => {
                        el.style.display = 'block';
                    });
                }
                
                // Load current election mode
                loadCurrentMode();
            } catch (error) {
                console.error('L·ªói:', error);
                window.location.href = 'login.html';
            }
        }
        
        function loadCurrentMode() {
            const config = JSON.parse(localStorage.getItem('election_config') || '{}');
            const modeText = document.getElementById('currentModeText');
            
            if (!config.mode) {
                config.mode = 'public';
                config.password = generateRandomPassword();
                localStorage.setItem('election_config', JSON.stringify(config));
            }
            
            if (config.mode === 'public') {
                modeText.innerHTML = '<span style="color: var(--primary-color); font-weight: bold;">üåê B·∫ßu c·ª≠ C√¥ng khai</span>';
            } else {
                modeText.innerHTML = '<span style="color: var(--danger-color); font-weight: bold;">üîí B·∫ßu c·ª≠ Kh√©p k√≠n</span>';
            }
        }
        
        function generateRandomPassword() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let password = '';
            for (let i = 0; i < 8; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password;
        }

        function initializeSimpleUI() {
            const tabs = document.getElementById('tabs');
            if (tabs) tabs.style.display = 'flex';
        }

        function setupSimpleListeners() {
            // Logout
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                        if (window.authModule) {
                            window.authModule.logout();
                        } else {
                            window.location.href = 'login.html';
                        }
                    }
                });
            }

            // Tab switching
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    const tabName = button.dataset.tab;
                    
                    // Remove active from all
                    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Add active to current
                    button.classList.add('active');
                    document.getElementById(tabName).classList.add('active');
                });
            });

            // Connect wallet button
            const connectBtn = document.getElementById('connectWallet');
            if (connectBtn) {
                connectBtn.addEventListener('click', () => {
                    alert('Ch·ª©c nƒÉng k·∫øt n·ªëi MetaMask s·∫Ω ƒë∆∞·ª£c t√≠ch h·ª£p sau khi deploy smart contract.\n\nHi·ªán t·∫°i b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng c√°c ch·ª©c nƒÉng kh√°c c·ªßa h·ªá th·ªëng.');
                });
            }
            
            // Form submission
            const candidateForm = document.getElementById('candidateForm');
            if (candidateForm) {
                candidateForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const name = document.getElementById('candidateName').value;
                    const position = document.getElementById('candidatePosition').value;
                    
                    alert(`ƒêƒÉng k√Ω ·ª©ng c·ª≠ th√†nh c√¥ng!\n\nH·ªç t√™n: ${name}\nV·ªã tr√≠: ${position}\n\n(Ch·ª©c nƒÉng n√†y s·∫Ω ƒë∆∞·ª£c t√≠ch h·ª£p v·ªõi blockchain sau)`);
                    candidateForm.reset();
                });
            }
            
            // Refresh results
            const refreshBtn = document.getElementById('refreshResults');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', () => {
                    alert('L√†m m·ªõi k·∫øt qu·∫£ b·∫ßu c·ª≠\n\n(Ch·ª©c nƒÉng n√†y s·∫Ω ƒë∆∞·ª£c t√≠ch h·ª£p v·ªõi blockchain sau)');
                });
            }
        }
    </script>
</body>
</html>
